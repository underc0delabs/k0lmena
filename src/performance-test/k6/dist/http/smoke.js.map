{
  "version": 3,
  "sources": ["../../http/smoke.ts", "../../lib/utils.ts", "../../lib/thresholds.ts", "../../reports/summary.js"],
  "sourcesContent": ["import http from 'k6/http';\nimport { sleep, check } from 'k6';\nimport { env, authHeaders } from '../lib/utils.js';\nimport { commonThresholds } from '../lib/thresholds.js';\n// @ts-expect-error JS module without TS types\nimport { handleSummary as k6HandleSummary } from '../reports/summary.js';\nexport { k6HandleSummary as handleSummary };\n\n\nexport const options = {\n  thresholds: commonThresholds,\n  scenarios: {\n    smoke: { executor: 'constant-vus', vus: 5, duration: '1m' }\n  },\n  tags: { suite: 'http-smoke' }\n};\n\nexport default function () {\n  const res = http.get(env.BASEURL, { headers: authHeaders() });\n  check(res, { 'status is 200': r => r.status === 200 });\n  sleep(1);\n}\n\n", "import { check, sleep } from 'k6';\nimport http, { RefinedResponse, ResponseType } from 'k6/http';\n\n// Reads from environment injected by GitHub Actions or your local shell.\n// In k0lmena you already keep .env at repo root; use a dotenv loader (npm scripts) if running locally.\nexport const env = {\n  BASEURL: __ENV.BASEURL || 'https://example.com',\n  API_BASEURL: __ENV.API_BASEURL || 'https://api.example.com',\n  AUTH_TOKEN: __ENV.AUTH_TOKEN || ''\n};\n\nexport function authHeaders(extra: Record<string, string> = {}) {\n  const base: Record<string, string> = { 'Content-Type': 'application/json' };\n  const headers = Object.assign({}, base, extra); // <- sin spread\n  if (env.AUTH_TOKEN) headers['Authorization'] = `Bearer ${env.AUTH_TOKEN}`;\n  return headers;\n}\n\nexport function ok(res: RefinedResponse<ResponseType | undefined>, name='status 2xx') {\n  return check(res, { [name]: r => !!r && r.status !== undefined && r.status >= 200 && r.status < 300 });\n}\n\nexport function pause(ms=500) { sleep(ms/1000); }\n\nexport function rnd(min: number, max: number) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n", "// Common defaults (widely used as a starting point)\nexport const commonThresholds = {\n  http_req_failed: ['rate<0.01'],\n  http_req_duration: ['p(95)<500', 'p(99)<1200'],\n  checks: ['rate>0.99']\n};\n", "// src/performance-test/k6/reports/summary.js\nfunction num(x) { return (typeof x === 'number' && isFinite(x)) ? x : null; }\n\nfunction simpleHtmlReport(data) {\n  const m = (data && data.metrics) || {};\n\n  const checksPass = m.checks?.passes ?? 0;\n  const checksFail = m.checks?.fails ?? 0;\n\n  const httpFailedRate = num(m.http_req_failed?.values?.rate) ?? 0;\n\n  const durVals = m.http_req_duration?.values || {};\n  const p95 = num(durVals['p(95)']);   // \uD83D\uDC48 claves con par\u00E9ntesis, usar bracket-notation\n  const p99 = num(durVals['p(99)']);\n\n  return `<!doctype html>\n<html lang=\"es\"><head>\n<meta charset=\"utf-8\"/>\n<title>k6 Summary</title>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>\n<style>\n  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:24px;background:#0b0f14;color:#e6edf3}\n  .card{background:#0f1720;border:1px solid #1f2a37;border-radius:12px;padding:18px;margin-bottom:16px}\n  h1{font-size:20px;margin:0 0 12px}\n  table{width:100%;border-collapse:collapse}\n  th,td{padding:8px 10px;border-bottom:1px solid #1f2a37;text-align:left;font-size:14px}\n  th{color:#9fb3c8}\n  .muted{color:#9fb3c8}\n  .ok{color:#22c55e}\n  .bad{color:#ef4444}\n</style>\n</head><body>\n  <div class=\"card\">\n    <h1>Resumen de ejecuci\u00F3n k6</h1>\n    <div class=\"muted\">Fecha: ${new Date().toLocaleString()}</div>\n  </div>\n\n  <div class=\"card\">\n    <table>\n      <tr><th>M\u00E9trica</th><th>Valor</th></tr>\n      <tr><td>Checks (pass/fail)</td><td>${checksPass} / ${checksFail}</td></tr>\n      <tr><td>Error rate (http_req_failed)</td><td class=\"${httpFailedRate < 0.01 ? 'ok':'bad'}\">${(httpFailedRate*100).toFixed(2)}%</td></tr>\n      <tr><td>http_req_duration p95</td><td>${p95 !== null ? p95 + ' ms' : '\u2014'}</td></tr>\n      <tr><td>http_req_duration p99</td><td>${p99 !== null ? p99 + ' ms' : '\u2014'}</td></tr>\n    </table>\n  </div>\n\n  <div class=\"card muted\">\n    JSON generado en: src/reports/performance/k6/summary.json\n  </div>\n</body></html>`;\n}\n\nexport function handleSummary(data) {\n  return {\n    'src/reports/performance/k6/summary.html': simpleHtmlReport(data),\n    'src/reports/performance/k6/summary.json': JSON.stringify(data, null, 2)\n  };\n}\n"],
  "mappings": ";AAAA,OAAO,UAAU;AACjB,SAAS,SAAAA,QAAO,SAAAC,cAAa;;;ACD7B,SAAS,OAAO,aAAa;AAKtB,IAAM,MAAM;AAAA,EACjB,SAAS,MAAM,WAAW;AAAA,EAC1B,aAAa,MAAM,eAAe;AAAA,EAClC,YAAY,MAAM,cAAc;AAClC;AAEO,SAAS,YAAY,QAAgC,CAAC,GAAG;AAC9D,QAAM,OAA+B,EAAE,gBAAgB,mBAAmB;AAC1E,QAAM,UAAU,OAAO,OAAO,CAAC,GAAG,MAAM,KAAK;AAC7C,MAAI,IAAI,WAAY,SAAQ,eAAe,IAAI,UAAU,IAAI,UAAU;AACvE,SAAO;AACT;;;ACfO,IAAM,mBAAmB;AAAA,EAC9B,iBAAiB,CAAC,WAAW;AAAA,EAC7B,mBAAmB,CAAC,aAAa,YAAY;AAAA,EAC7C,QAAQ,CAAC,WAAW;AACtB;;;ACJA,SAAS,IAAI,GAAG;AAAE,SAAQ,OAAO,MAAM,YAAY,SAAS,CAAC,IAAK,IAAI;AAAM;AAE5E,SAAS,iBAAiB,MAAM;AAHhC;AAIE,QAAM,IAAK,QAAQ,KAAK,WAAY,CAAC;AAErC,QAAM,cAAa,aAAE,WAAF,mBAAU,WAAV,YAAoB;AACvC,QAAM,cAAa,aAAE,WAAF,mBAAU,UAAV,YAAmB;AAEtC,QAAM,kBAAiB,UAAI,aAAE,oBAAF,mBAAmB,WAAnB,mBAA2B,IAAI,MAAnC,YAAwC;AAE/D,QAAM,YAAU,OAAE,sBAAF,mBAAqB,WAAU,CAAC;AAChD,QAAM,MAAM,IAAI,QAAQ,OAAO,CAAC;AAChC,QAAM,MAAM,IAAI,QAAQ,OAAO,CAAC;AAEhC,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAmBuB,oBAAI,KAAK,GAAE,eAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAMhB,UAAU,MAAM,UAAU;AAAA,4DACT,iBAAiB,OAAO,OAAK,KAAK,MAAM,iBAAe,KAAK,QAAQ,CAAC,CAAC;AAAA,8CACpF,QAAQ,OAAO,MAAM,QAAQ,QAAG;AAAA,8CAChC,QAAQ,OAAO,MAAM,QAAQ,QAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ9E;AAEO,SAAS,cAAc,MAAM;AAClC,SAAO;AAAA,IACL,2CAA2C,iBAAiB,IAAI;AAAA,IAChE,2CAA2C,KAAK,UAAU,MAAM,MAAM,CAAC;AAAA,EACzE;AACF;;;AHjDO,IAAM,UAAU;AAAA,EACrB,YAAY;AAAA,EACZ,WAAW;AAAA,IACT,OAAO,EAAE,UAAU,gBAAgB,KAAK,GAAG,UAAU,KAAK;AAAA,EAC5D;AAAA,EACA,MAAM,EAAE,OAAO,aAAa;AAC9B;AAEe,SAAR,gBAAoB;AACzB,QAAM,MAAM,KAAK,IAAI,IAAI,SAAS,EAAE,SAAS,YAAY,EAAE,CAAC;AAC5D,EAAAC,OAAM,KAAK,EAAE,iBAAiB,OAAK,EAAE,WAAW,IAAI,CAAC;AACrD,EAAAC,OAAM,CAAC;AACT;",
  "names": ["sleep", "check", "check", "sleep"]
}
